(()=>{"use strict";(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function n(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?t(Object(o),!0).forEach((function(t){s(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(t,n,s){return(n=function(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var o=s.call(t,n||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,t}$((function(){var e,t;$("#currentUserId").val();function s(e,t){0===$("#user-message").length&&$("body").append('<div id="user-message" class="message-container"></div>');var n=$('<div class="message '.concat("success"===t?"success-message":"error-message",'">').concat(e,"</div>"));$("#user-message").append(n),setTimeout((function(){n.fadeOut(300,(function(){$(this).remove()}))}),3e3)}function o(e,t){var n=window.location.protocol,s=window.location.host;window.location.href="".concat(n,"//").concat(s,"/admin/userslist/").concat(e,"/").concat(t)}function a(e){return confirm("Are you sure you want to ".concat(e,"?"))}function i(e,t,n){return new Promise((function(o,a){c({url:"/admin/api/posts/".concat(e,"/").concat(t),method:"POST",element:n,successCallback:function(e){o(e)},errorCallback:function(e,n){s(n.message||"Failed to ".concat(t," post"),"error"),a(n)}})}))}function r(e){var t=e.hasClass("deleted-post"),n=e.hasClass("blocked-post"),s=e.data("original-content"),o=e.find(".delete-post-btn"),a=e.find(".restore-post-btn"),i=e.find(".block-post-btn"),r=e.find(".unblock-post-btn"),c=e.find(".post-status-badges");c.empty(),t?(c.append('<span class="deleted-status status-badge">DELETED</span>'),e.find(".post-content").html('<p class="system-message">This post was deleted by the admin, because it violated the community rules.</p>')):e.find(".post-content p.system-message").length||e.find(".post-content p").text()||e.find(".post-content").html("<p>".concat(s,"</p>")),n?(c.append('<span class="blocked-status status-badge">BLOCKED</span>'),t||e.find(".post-content").html('<p class="system-message">This post was blocked by the admin, because it violated the community rules.</p>')):t||e.find(".post-content").html("<p>".concat(s,"</p>")),o.prop("disabled",t),a.prop("disabled",!t),i.prop("disabled",n||t),r.prop("disabled",!n||t);var l=e.find(".comments-section"),d=e.find(".toggle-comments-btn");t||n?(t?d.addClass("deleted-btn").removeClass("blocked-btn"):n&&d.addClass("blocked-btn").removeClass("deleted-btn"),l.hasClass("hidden")||(l.addClass("hidden"),d.html('<i class="fas fa-angle-down"></i> Show Comments'))):d.removeClass("deleted-btn blocked-btn")}function c(e){var t=n(n({},{method:"GET",data:{},showLoadingContainer:!1}),e);(t.element&&t.element.addClass("loading"),t.showLoadingContainer&&t.loadingContainer)&&$(t.loadingContainer).addClass("loading container-loading");$.ajax({url:t.url,method:t.method,data:t.data,success:function(e){t.element&&t.element.removeClass("loading"),t.showLoadingContainer&&t.loadingContainer&&$(t.loadingContainer).removeClass("loading container-loading"),"function"==typeof t.successCallback&&t.successCallback(e)},error:function(e,n,o){t.element&&t.element.removeClass("loading"),t.showLoadingContainer&&t.loadingContainer&&$(t.loadingContainer).removeClass("loading container-loading");var a={message:"An error occurred"};try{e.responseJSON?a=e.responseJSON:e.responseText&&(a=JSON.parse(e.responseText))}catch(e){console.warn("Failed to parse error response:",e)}"function"==typeof t.errorCallback?t.errorCallback(o,a,e):function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o="An unexpected error occurred",a={};"string"==typeof e?o=e:e.responseJSON?(o=e.responseJSON.error||"Server error (".concat(e.status||"unknown status",")"),a={status:e.status,statusText:e.statusText,responseJSON:e.responseJSON}):e instanceof Error?(o=e.message,a={name:e.name,stack:e.stack}):e.error&&(o=e.error,a=e),console.error("Error in ".concat(t,":"),o,a),n&&s(o,"error")}(o,{context:"API call to ".concat(t.url),status:e.status,errorData:a})}})}$("#currentUserId").length>0&&(e=$(".posts-list"),t=$(".feed-list-container"),window.adminCache={$postsList:e,$postsContainer:t,selectors:{}},$(document).on("click",".delete-post-btn",(function(){var e=$(this),t=e.data("post-id"),n=e.closest(".post-item");a("delete this post")&&i(t,"delete",e).then((function(e){e.success&&(n.addClass("deleted-post"),n.find(".post-content").html('<p class="system-message">This post was deleted by the admin, because it violated the community rules.</p>'),r(n),s(e.message||"Post deleted","success"))}))})),$(document).on("click",".restore-post-btn",(function(){var e=$(this),t=e.data("post-id"),n=e.closest(".post-item"),o=n.data("original-content");a("restore this post")&&i(t,"restore",e).then((function(e){e.success&&(n.removeClass("deleted-post"),n.find(".post-content").html("<p>".concat(o,"</p>")),r(n),s(e.message||"Post restored","success"))}))})),$(document).on("click",".block-post-btn",(function(){var e=$(this),t=e.data("post-id"),n=e.closest(".post-item");a("block this post")&&i(t,"block",e).then((function(e){e.success&&(n.addClass("blocked-post"),n.hasClass("deleted-post")||n.find(".post-content").html('<p class="system-message">This post was blocked by the admin, because it violated the community rules.</p>'),r(n),s(e.message||"Post blocked","success"))}))})),$(document).on("click",".unblock-post-btn",(function(){var e=$(this),t=e.data("post-id"),n=e.closest(".post-item"),o=n.data("original-content");a("unblock this post")&&i(t,"unblock",e).then((function(e){e.success&&(n.removeClass("blocked-post"),n.hasClass("deleted-post")||n.find(".post-content").html("<p>".concat(o,"</p>")),r(n),s(e.message||"Post unblocked","success"))}))})),$(document).on("click",".toggle-comments-btn",(function(){var e=$(this),t=e.closest(".post-item").find(".comments-section");e.toggleClass("active"),t.hasClass("hidden")?(t.removeClass("hidden"),setTimeout((function(){t.addClass("visible")}),10),e.html('<i class="fas fa-angle-up"></i> Hide commentaries')):(t.removeClass("visible"),setTimeout((function(){t.addClass("hidden")}),400),e.html('<i class="fas fa-angle-down"></i> Show commentaries'))})),$(document).on("click",".delete-comment-btn",(function(){var e=$(this),t=e.data("post-id"),n=e.data("comment-id"),o=e.closest(".comment-item"),i=e.closest(".post-item").find(".comments-count");a("delete this comment")&&c({url:"/admin/posts/".concat(t,"/comments/").concat(n),method:"DELETE",element:e,successCallback:function(e){o.fadeOut(300,(function(){$(this).remove();var e=i.closest(".post-item");!function(e,t){var n=e.find(".comments-count");n.text("Comments (".concat(t,")"));var s=e.find(".comments-section");s.find(".comment-item").length,0!==t||s.hasClass("hidden")||(0===s.find(".no-comments-message").length&&s.html('<p class="no-comments-message">No comments</p>'),s.addClass("visible"));var o=e.find(".toggle-comments-btn");o.length&&(o.text(t>0?"Show comments (".concat(t,")"):"No comments"),0===t?o.addClass("disabled"):o.removeClass("disabled"))}(e,parseInt(i.text().match(/\d+/)[0])-1);var t=e.find(".comments-section");0!==t.find(".comment-item").length||t.hasClass("hidden")||(t.html('<p class="no-comments-message">No commentaries</p>'),t.addClass("visible")),s("Comment deleted successfully","success")}))},errorCallback:function(e){s("Failed to delete comment","error"),console.error("Error deleting comment:",e)}})}))),function(){0===$(".offline-indicator").length&&$("body").prepend('<div class="offline-indicator">You are offline. Some features are unavailable.</div>');window.addEventListener("online",(function(){$("body").removeClass("offline"),s("You are back online","success")})),window.addEventListener("offline",(function(){$("body").addClass("offline"),s("You are offline. Some features are unavailable.","warning")})),navigator.onLine||$("body").addClass("offline")}(),$(document).on("click",".user-friends",(function(){o($(this).data("id"),"friends")})),$(document).on("click",".user-feed",(function(){o($(this).data("id"),"feed")})),$(document).on("click",".delete-friend-btn",(function(){var e=$(this),t=e.closest(".friend-row"),n=e.data("friend-id"),o=$("#currentUserId").val();n&&o&&a("remove this friend")&&c({url:"/admin/userslist/".concat(o,"/friends"),method:"DELETE",data:{friendId:n},element:e,successCallback:function(){t.fadeOut(300,(function(){$(this).remove(),s("Friend removed successfully","success"),0===$(".friend-row").length&&$(".friends-table").html('<div class="no-friends">No friends found</div>')}))},errorCallback:function(e){s("Failed to remove friend","error"),console.error("Error removing friend:",e)}})})),$(document).on("click",".save-changes",(function(){var e=$(this),t=e.data("id"),n=e.closest(".user-row"),o={fullname:n.find("input[type='text'][id='floatingInputValue']").val(),email:n.find("input[type='email']").val(),birthdate:n.find("input[type='date']").val(),role:n.find(".role input").val(),status:n.find(".status input").val()};o.fullname&&o.email?c({url:"/admin/users/".concat(t),method:"PUT",data:o,element:e,successCallback:function(e){s("User data updated successfully","success")},errorCallback:function(e){s("Failed to update user data","error"),console.error("Error updating user:",e)}}):s("Name and email are required fields","error")})),$(document).on("click",".dropdown-item.role-admin, .dropdown-item.role-user",(function(e){e.preventDefault();var t=$(this).data("value")||$(this).text(),n=$(this).closest(".input-group").find("input.form-control");n.val(t),n.attr("class","form-control role-"+t)})),$(document).on("click",".dropdown-item.status-active, .dropdown-item.status-unverified, .dropdown-item.status-blocked",(function(e){e.preventDefault();var t=$(this).data("value")||$(this).text(),n=$(this).closest(".input-group").find("input.form-control");n.val(t),n.attr("class","form-control status-"+t)})),$(document).ready((function(){}))}))})()})();